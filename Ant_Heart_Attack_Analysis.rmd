---
title: 'Heart Attack Dataset: An Analysis'
author: "Ananthajit Srikanth"
date: "19/07/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

Heart attacks are the leading cause of death worldwide (source: Our World in Data). Hence, understanding how to predict the possibility of heart disease is extremely important. 

This analysis will use the UCI Machine Learning Repository's Heart Disease Dataset to predict the risk of heart disease in patients.

## Dataset Information

This analysis uses four datasets, each of which are from four different regions:

* Hungarian Institute of Cardiology
* University Hospital, Zurich, Switzerland and University Hospital, Basel, Switzerland
* Cleveland Clinic Foundation
* V.A. Medical Center, Long Beach

Each of these regions form the *processed.hungarian*,*processed.switzerland*,*processed.cleveland*, and *processed.va* datasets.

The *processed* prefix indicates that out of 76 variables, only 14 are used. All the tables are also comma separated.

Given below are the variables in the dataset, as per the heart-disease.names file:

1. Age in years
2. Sex (assigned at birth) (1 is male, and 0 is female)
3. Chest Pain Type (one of four values):
  1 - Typical Angina
  2 - Atypical Angina
  3 - Non anginal Pain
  4 - Asymptomatic
4. trestbps - Resting Blood Pressure in mm Hg
5. chol - Serum Cholesterol in mg/dl
6. fbs - Is fasting blood sugar greater than 120 mg/dl? (1 = yes, 2 = no)
7. restecg - Resting Electrocardiogram (ECG) results (one of three values):
  0 - Normal
  1 - Having ST-T wave abnormality (T wave inversions and/or ST elevation or depression of > 0.05 mV): This is a symptom of Myocardial Infarction
  2 - Showing probable or definite left ventricular hypertrophy by Estes' criteria (enlargment of the left ventricle, usually to compensate for tissue loss)
8. thalach - Maximum Heart Rate Achieved (in beats per minute)
9. exang - Exercise Induced Angina (1 = yes, 0 = no)
10. oldpeak - ST depression induced by exercise relative to rest
11. slope - Slope of ST segment (as seen in ECG) during excercise:
  * 1 - Upsloping
  * 2 - Flat
  * 3 - Downsloping
12. ca - Number of vessels colored by fluoroscopy (0 - 3) 
13. thal: One of three possible values:
  * 3 - Normal
  * 6 - Fixed Defect
  * 7 - Reversible Defect

14. num (outcome) - Diagnosis of Heart Disease:
  1 - More than 50% narrowing of diameter of any major heart vessel
  0 - Less than 50% narrowing of diameter of any major heart vessel.  
  
## Creating the Datasets

The datasets are publicly available at the [UCI Machine Learning repository website](https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/) 

First, libraries have to be loaded for analysis:

```{r}
# Heart attack analysis

# Loading the required libraries, can add required libraries later in vector (same code as used in previous project, source: Ananthajit Srikanth)
required_libraries <- c("caret", "matrixStats", "tidyverse", "knitr", "lubridate", "broom", "randomForest", "rattle", "rpart")
# The for loop installs and loads libraries one by one from required_libraries
for(i in 1:length(required_libraries)){
  if(!require(required_libraries[i], character.only = TRUE)){
    install.packages(required_libraries[i], repos = "http://cran.us.r-project.org")
    library(required_libraries[i], character.only = TRUE)
  }
  else{
    require(required_libraries[i], character.only = TRUE)}}

# Run this line only if necessary:
# update.packages()
```

Once the libraries are loaded, the datasets can be downloaded:
Looking at one file, we can see the structure of the data:
```{r}
# Show that the files are comma-separated
download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data", destfile = 'processed.cleveland.data')
readLines(con = 'processed.cleveland.data', n = 1)

```
We can see that the file has comma-separated values.

Looking at the other three tables:

```{r}
download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.hungarian.data", destfile = "processed.hungarian.data")

download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.va.data", destfile = "processed.va.data")

download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.switzerland.data", destfile = "processed.switzerland.data")

noquote("Hungarian")
readLines(con = 'processed.hungarian.data', n = 1)
noquote("Switzerland")
readLines(con = 'processed.switzerland.data', n = 1)
noquote("va")
readLines(con = 'processed.va.data', n = 1)

```

They are also comma-separated. It can also be seen that some fields have a ?. This can be replaced by an NA.

The files can now be downloaded in the csv format:

```{r}
# Downloading the processed.data files as csv

download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data", destfile = "cleveland.csv")

download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.hungarian.data", destfile = "hungarian.csv")

download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.va.data", destfile = "va.csv")

download.file(url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.switzerland.data", destfile = "switzerland.csv")


```

Based on the documentation provided in heart-disease.names in the data folder, the column names can be stored in a vector:


```{r}
# Column names for data frames
colnames_heartattack <- c("age", "sex", "cp", "trestbps", "chol", "fbs", "restecg", "thalach", "exang", "oldpeak", "slope", "ca", "thal", "num")
```

As the csv files have been downloaded, now they can be read.

```{r}
cleveland <- read_csv("cleveland.csv", col_names = colnames_heartattack)


```

As can be seen, read_csv converted ca and thal (which use numbers as categories) as characters, most likely due to the presence of '?'

```{r}
any(str_detect(cleveland$thal, pattern = "\\?"))
```
This shows that there is at least one "?" in the column *thal*, hence it has been assigned the character variable type.

As all of the columns contain numbers/numerical values, `as.numeric()` can be used to convert all the columns into numerics. However, the ?s have to be converted to NAs first.

```{r}
# Convert all ? to NA
cleveland[cleveland == "?"] <- NA
# Convert all columns to numeric
cleveland <- apply(cleveland, 2, function(x) as.numeric(x)) %>% as.data.frame()

```

As there are multiple datasets, the region of the dataset also has to be specified. In the case of the *cleveland* dataset, the variable *dataset* shall be set to *cleveland*

```{r}
# specify the dataset region
cleveland <- cleveland %>% mutate(dataset = 'cleveland')

```


The same process is repeated for the other three datasets:

```{r}
switzerland <- read_csv("switzerland.csv", col_names = colnames_heartattack)
switzerland[switzerland == "?"] <- NA
switzerland <- apply(switzerland, 2, function(x) as.numeric(x)) %>% as.data.frame()
switzerland <- switzerland %>% mutate(dataset = 'switzerland')

hungarian <- read_csv("hungarian.csv", col_names = colnames_heartattack)
hungarian[hungarian == "?"] <- NA
hungarian <- apply(hungarian, 2, function(x) as.numeric(x)) %>% as.data.frame()
hungarian <- hungarian %>% mutate(dataset = "hungarian")

va <- read_csv("va.csv", col_names = colnames_heartattack)
va[va == "?"] <- NA
va <- apply(va, 2, function(x) as.numeric(x)) %>% as.data.frame()
va <- va %>% mutate(dataset = "va")

```

The datasets can now be joined together in a table called *total_set*:

```{r}
# join the four datasets together
total_set <- bind_rows(cleveland, switzerland, hungarian, va)

```

From the dataset documentation, although all columns use numerical values, some numerical values are used to represent categorical outcomes, so these have to be converted to factors:


```{r}

total_set <- total_set %>% mutate(num = as.factor(num), sex = as.factor(sex), cp = as.factor(cp), fbs = as.factor(fbs), restecg = as.factor(restecg),exang = as.factor(exang), slope = as.factor(slope), ca = as.factor(ca), thal = as.factor(thal))
```












# Bibliography
1. Hungarian Institute of Cardiology. Budapest: Andras Janosi, M.D.
       2. University Hospital, Zurich, Switzerland: William Steinbrunn, M.D.
       3. University Hospital, Basel, Switzerland: Matthias Pfisterer, M.D.
       4. V.A. Medical Center, Long Beach and Cleveland Clinic Foundation:
	  Robert Detrano, M.D., Ph.D.
https://ourworldindata.org/causes-of-death
https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/